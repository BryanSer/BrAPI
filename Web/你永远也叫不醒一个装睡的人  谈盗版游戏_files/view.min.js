var __slice=[].slice,__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};$(function(){return system.gate.guideFloatDisabled=1,$.require("ready",function(){var a;return system.func.saveHistory=function(){var a,b,c,d,e,f,g,h,i;for(e=1<=arguments.length?__slice.call(arguments,0):[],f=e[0]||"views",b=null!=(g=cache.history)[f]?g[f]:g[f]=[],d=system.post,c=h=0,i=b.length;i>h;c=++h)if(a=b[c],d.aid===a.aid){b.splice(c,1);break}return b.push({time:$.now(),date:d.date,aid:d.aid,title:d.title,cid:d.cid,tags:d.tags,preview:d.preview,uid:d.uid,name:d.name,part:d.part,avatar:d.avatar,cont:"comms"===f?e[1]:null}),b.length>(window.localStorage?100:20)&&b.splice(0,1),$.save("cache")},function(){var a,b,c,d;return d=$$("#btn-top-shortcut"),a=d.find(".item")[1],$(a).hide(),b=d.find(".item")[0],b=$(b).find("i"),b.removeClass("icon-comments"),b.css({background:'url("'+system.path.short+'/project/homura/style/nimage/comment.png") 5px 10% no-repeat'}),c=d.find(".item")[2],c=$(c).find("i"),c.removeClass("icon-chevron-up"),c.css({background:'url("'+system.path.short+'/project/homura/style/nimage/navigateup.png") 7px no-repeat'}),$(d.find(".item")[0]).on("click",function(){return ga("send","event","skip","comment_web","")})}(),function(){var a,b;return a=$(".pinglun"),a.on("click",function(){return $("html,body").animate({scrollTop:$("#area-comment").offset().top-100},800)}),b=$(".txt-info-title_1").find(".pts")[1],$(b).on("click",function(){return $("html,body").animate({scrollTop:$("#area-comment").offset().top-100},800)})}(),function(){var a,b;return b=$$(".block-info-bottom-l .btn2").click(function(){var a;return a=$$(".block-info-bottom-l .btn1").click()}),a=$$(".block-info-bottom-l .btn1"),a.on("click",function(){var b,c,d,e,f,g;return c=$(this),d=c.is(a)?"top":"bottom",a.hasClass("disabled")?void 0:(a.addClass("disabled"),setTimeout(function(){return a.removeClass("disabled")},1e3),b=($$(window).width()-550)/2,user.online?a.data().active?(e="warning::请勿重复投食。",a):user.userGroupLevel<1?(g=a,void a.unfold({src:"../project/sanae/html/warning",id:"win-banana",icon:"warning",title:"",width:528,height:177,left:b,top:($$(window).height()-348)/2.5+$$(window).scrollTop(),curtain:!0,callback:function(){var a;return a=$("#win-banana"),a.css({left:b}),a.find(".pp .h").html("您的账户权限无法使用此功能，请通过"),a.find(".pp a").html("游戏答题"),a.find(".pp .f").html("激活。"),c=a.find(".btn"),c.html("答题激活"),c.attr({href:"/"}).on("click",function(b){var c;return b.preventDefault(),c="../html/pop",c=-1===c.search(/http\:\/\//)?"/dotnet/date/html/"+c+".html":c,c+=$.salt(),$.get(c).done(function(b){return a.find(".close").click(),$("#mainer").append("<div>"+b+"</div>"),StartAnsQues(g)}).fail(function(){return $.info("error::通信失败！")})})}})):user.checkMobile<1?void a.unfold({src:"../project/sanae/html/warning",id:"win-banana",icon:"warning",title:"",width:528,height:177,left:b,top:($$(window).height()-348)/2.5+$$(window).scrollTop(),curtain:!0,callback:function(){return $("#win-banana").css({left:b})}}):(null!=(f=a.data().port)&&f.abort(),a.data().port=$.post("/banana/throwBanana.aspx",{contentId:system.post.aid,count:1,userId:user.uid}).done(function(b){var c;return b.success?(c="success::成功投食了1根香蕉。",a.data({active:1}),a.find(".push1").addClass("moving").parent().parent().find(".txt-pushbanana2").html('<font color="#AEA7A5">UP主食蕉中</span>'),setTimeout(function(){return a.find(".push1").removeClass("moving")},1e3),setTimeout(function(){return a.find(".push1").addClass("active").parent().parent().find(".txt-pushbanana2").html('<font color="#AEA7A5">已投蕉</span>'),system.func.rvi()},2e3)):(c="warning::"+b.result,$.info(c),a)}).fail(function(){var b;return b="warning::投食操作失败。请于稍后重新操作。",$.info(b),a})):(e="warning::您尚未登录。请先行登录。",$.info(e),a.unfold("login",function(){return $("#win-login").css({"margin-top":"100px"})})))})}(),function(){var a,b,c,d,e,f,g,h,i,j;for(b=$$("#block-data-view"),c=function(a){return $.parseSafe(b.data(a)||"")},d=function(a){return 0|(b.data(a)||0)},system.post={},i=["name","avatar","title","tags","preview"],e=0,g=i.length;g>e;e++)a=i[e],system.post[a]=c(a);for(j=["uid","aid","cid","views","comms","favors","shares","time"],f=0,h=j.length;h>f;f++)a=j[f],system.post[a]=d(a);return system.post.desc=$$("#block-info-top").find("p.shadow").text(),system.post.tags=system.post.tags.split(","),system.post.date=$.timeStamp(b.data("date"))}(),"function"==typeof(a=system.func).readyPlayer&&a.readyPlayer(),function(){var a,b;return a=$$("#area-part-view"),system.post.parts=0|a.data().parts,system.post.part=0|a.data().part,a.data().parts>2?(b=$$("#btn-more-part"),b.data({active:0}).click(function(){return b.data().active?(b.data({active:0}).removeClass("active").find("p").text("展开").end().find("i").addClass("icon-plus-circle").removeClass("icon-minus-sign"),a.removeClass("active")):(b.data({active:1}).addClass("active").find("p").text("收起").end().find("i").addClass("icon-minus-sign").removeClass("icon-plus-circle"),a.addClass("active").children("div.l").scrollTop(32*(a.find("a.active").eq(0).index()-1)))})):void 0}(),function(){var a,b;return b=$("#block-info-top p.desc:not(.shadow)"),a=b.html(),a=a.replace(/(?:(?:http:\/\/)?[\w\/\.\-]+?acfun\.[\w\/\.\-]+?)?\[?ac(\d+(?:_\d+)?)\]?/g,'<a href="http://www.acfun.tv/v/ac$1" target="_blank">[ac$1]</a>').replace(/(?:(?:http:\/\/)?[\w\/\.\-]+?acfun\.[\w\/\.\-]+?)?\[?aa(\d+)\]?/g,'<a href="http://www.acfun.tv/a/aa$1" target="_blank" title="该链接通向AcFun合辑">[aa$1]</a>').replace(/(?:(?:http:\/\/)?[\w\/\.\-]+?nicovideo\.[\w\/\.\-]+?)?\[?sm(\d+)\]?/g,'<a href="http://www.nicovideo.jp/watch/sm$1" title="该链接通向ニコニコ动画" target="_blank">[sm$1]</a>').replace(/\[wiki(\S+?)\]/g,'<a href="http://wiki.acfun.tv/index.php/$1" title="该链接通向AC百科" target="_blank">[$1]</a>'),b.html(a)}(),function(){var a,b,c;return a=$$(".txt-info-title_1"),b=$$(".txt-info-title_2"),a.data({post:null}),c=function(){return c.a(),c.b()},c.a=function(){var c;return system.param.shareUid&&(c=system.param.shareUid.match(/(\d+)?#?.*/),system.param.shareUid=c&&c[1]?c[1]:null),$.get("/content_view.aspx",{contentId:system.post.aid,channelId:system.post.cid,shareUid:system.param.shareUid!==user.uid?system.param.shareUid:null}).done(function(c){var d,e,f,g,h,i,j,k;return e=c.toString().split(","),h=a.children("span.pts"),i=b.children("span.pts"),j=h.eq(0).text($.parsePts(e[0])),i.eq(0).text($.parsePts(e[0])),d=$("#comment_able"),f=d.val(),d.length&&"2"===f&&(e[1]=0),g=e[1]>9999?Math.round(e[1]/1e3)/10+"万":$.parsePts(e[1]),h.eq(1).text(null!=(k="2"===$("#comment_able").val())?k:{0:$.parsePts(e[1])}),h.eq(1).text($.parsePts(e[1])),i.eq(1).text($.parsePts(e[1])),$$("#btn-comm-view span").text(g),$$("#btn-top-shortcut").find("span.pts").text(g),g=e[3]>9999?Math.round(e[3]/1e3)/10+"万":$.parsePts(e[3]),$$("#btn-up-toolbar").find("span").text($.parsePts(e[3])),$$("#btn-up-view").find("span").text(g),g=e[6]>9999?Math.round(e[6]/1e3)/10+"万":$.parsePts(e[6]),h.eq(2).text(g),i.eq(2).text(g),g=e[5]>9999?Math.round(e[5]/1e3)/10+"万":$.parsePts(e[5]),$$("#btn-favor-toolbar span").text($.parsePts(g))}).fail(function(){var b;return b="文章播放信息读取失败",a.text(b)})},c.b=function(){return $.get("/member/collect_up_exist.aspx",{contentId:system.post.aid}).done(function(b){var c,d,e,f,g,h,i,j,k,l;if(b.success&&(e=$$("#btn-favor-toolbar-copy"),b.data.collect?(system.post.isFavored=1,$$("#btn-favor-toolbar").data({active:1}).addClass("active"),$$(".txt-favorite").show("slow"),e.addClass("active"),e.parent().find(".txt-favorite2").addClass("active").text("已收藏")):(system.post.isFavored=0,$$("#btn-favor-toolbar").data({active:0}).removeClass("active"),$$(".txt-favorite").hide("slow"),e.removeClass("active"),e.parent().find(".txt-favorite2").removeClass("active").text("收藏")),b.data.up?(system.post.isUped=1,$$("#btn-up-view").data({active:1}).add("#btn-up-toolbar").addClass("active").find("p").text("已点赞")):system.post.isUped=0,b.data.banana?(system.post.isThrowed=1,$$(".pushbanana2").data({active:1}).addClass("active").parent().find(".txt-pushbanana2").html('<font color="#AEA7A5">已投蕉</span>')):(system.post.isThrowed=0,$$(".pushbanana2").data({active:0})),b.data.follow?(system.post.isFollowing=1,$$("#btn-follow-author").data({active:1}).text("已关注")):(system.post.isFollowing=0,$$("#btn-follow-author").removeClass("active").data({active:0}).text("+ 关注")),b.data.tagList)){for(g=$("#area-tag-view span.inner"),h=$("#area-tag-view span.inner span#btn-add-tag"),i=$("#temp-tag-view").html(),f="",l=b.data.tagList,j=0,k=l.length;k>j;j++)c=l[j],f+=$.parseTemp(i,{tid:c.tagId,name:$.parseSafe_($.parseSafe(c.tagName)),count:$.parsePts(c.refCount)});if(h.prevAll().remove(),h.before(f),$$("#loading_").hide(),10===b.data.tagList.length)return d=$$("#btn-add-tag").addClass("disabled").mouseover(function(){var a;return a="warning::该文章标签数目已达上限。"});if(a=$$("#area-tag-view"),a.data().active)return d=$$("#btn-add-tag").mouseover(function(){var a;return a="success::添加标签方便其他Acer搜索哦~~"})}})},(system.func.rvi=c)()}(),function(){var a,b,c;return c=$$("#btn-favor-toolbar-copy").click(function(){var a;return a=$$("#btn-favor-toolbar").click()}),c.parent().find(".txt-favorite2").click(function(){var a;return a=$$("#btn-favor-toolbar").click()}),$$(".txt-favorite").click(function(){var a;return a=$$("#btn-favor-toolbar").click()}),b=$$("#btn-favor-toolbar"),a=b,a.click(function(){var d,e,f,g,h;return d=$(this),e=d.is(b)?"top":"bottom",d.hasClass("disabled")?void 0:(a.addClass("disabled"),setTimeout(function(){return a.removeClass("disabled")},1e3),user.online?(b.data().active?(f=0,g="success::已取消当前文章收藏。",$.info(g),d.removeClass("active"),c.addClass("active"),c.parent().find(".txt-favorite2").removeClass("active").text("收藏"),b.data({active:0})):(f=1,g="success::已收藏当前文章。",$.info(g),d.addClass("active"),c.addClass("active"),c.parent().find(".txt-favorite2").text("已收藏"),b.data({active:1})),null!=(h=b.data().port)&&h.abort(),b.data().port=$.post("/member/collect.aspx",{cId:system.post.aid,operate:f}).done(function(a){return a.success?system.func.rvi():void 0})):(g="warning::您尚未登录。请先行登录。",$.info(g),d.unfold("login",function(){return $("#win-login").css({"margin-top":"100px"})})))})}(),function(){var a,b;return b=$$("#btn-up-view"),a=b.add("#btn-up-toolbar"),a.click(function(){var c,d,e,f;return c=$(this),d=c.is(b)?"top":"bottom",c.hasClass("disabled")?void 0:(a.addClass("disabled"),setTimeout(function(){return a.removeClass("disabled")},1e3),user.online?b.data().active?(e="warning::请勿重复点赞。",$.info(e)):(e="success::点赞成功。",$.info(e),a.addClass("active").find("p").text("已点赞"),b.data({active:1}),null!=(f=b.data().port)&&f.abort(),b.data().port=$.post("/content_up.aspx",{contentId:system.post.aid}).done(function(a){return a.success?system.func.rvi():void 0})):(e="warning::您尚未登录。请先行登录。",$.info(e),c.unfold("login")))})}(),$$("#btn-comm-view").click(function(){return $$("#area-bottom-view").scrollOnto()}),$$("#btn-follow-author").click(function(){var a;return a=$(this),user.online?a.hasClass("disabled")?void 0:(a.addClass("disabled"),setTimeout(function(){return a.removeClass("disabled")},1e3),a.data().active?a.ensure({curtain:!0,text:"是否确认取消关注？",callback:function(){var b;return null!=(b=a.data().port)&&b.abort(),a.data().port=$.post("/api/friend.aspx?name=unfollow",{username:a.data().name,userId:a.data().uid,groupId:0}).done(function(b){var c;return b.success?(c="info::取消关注["+$.parseSafe(a.data().name)+"]成功。",$.info(c),system.func.rvi()):(c="warning::"+b.result,$.info(c))}).fail(function(){var b;return b="error::取消关注["+$.parseSafe(a.data().name)+"]失败。请于稍后重试。",$.info(b)})}}):a.unfold("follow",function(){return $("#win-follow").data({name:a.data().name,uid:a.data().uid,callback:system.func.rvi})})):void a.unfold("login",function(){return $("#win-login").css({"margin-top":"100px"})})}),setTimeout(function(){var a,b;return a=$("#comment_able"),b=a.val(),a.length&&"2"===b?void 0:$.require("comm",function(){var a;return"function"==typeof(a=$$("#area-comment").data().func).ready?a.ready(function(){var a;return a=$$("#btn-showComm"),config.comment.autoShowCommentAllowed?a.click():a.css({display:"block"})}):void 0})},500),setTimeout(function(){var a;return a=system.post,$$("#bdshare").share({text:a.title+" Up主："+a.name+"  \n来自AcFun "+$.parseChannel(0|a.cid)+" 频道",url:"http://www.acfun.tv/"+("video"===system.type?"v/ac":"a/ac")+a.aid+(user.online?"?shareUid="+user.uid:""),preview:a.preview},"baidu.com"),$$("#bdshare_2").share_2({text:a.title+" Up主："+a.name+"  \n来自AcFun "+$.parseChannel(0|a.cid)+" 频道",url:"http://www.acfun.tv/"+("video"===system.type?"v/ac":"a/ac")+a.aid+(user.online?"?shareUid="+user.uid:""),preview:a.preview},"baidu.com")},2e3),function(){var a,b;return a=$$("#area-tag-view"),b=$$("#btn-add-tag"),user.online&&(a.data().active?b.click(function(){var c,d,e;return c=5,user.level>=c?(d=a.find("span.tag"),d.length<10?b.edit({text:"请输入标签",width:160,callback:function(a){var c,d;return c=$.trim($.parseSafe(a.replace(/\s+/g,"_"))),c?(null!=(d=b.data().port)&&d.abort(),b.data().port=$.post("/addTag.aspx",{tagName:c,contentId:system.post.aid}).done(function(d){return d.success?($.info("success::添加标签["+c+"]成功。"),system.func.rvi.b()):($.info("warning:"+d.result),b.info(a))}).fail(function(){return $.info(a="error::同服务器通信失败。请于稍后重试。")})):void 0}}):(e="warning::该文章标签数目已达上限。",$.info(e))):(e="warning::用户等级不足["+c+"]。无权添加标签。",$.info(e))}).removeClass("hidden"):b.addClass("disabled").text("该文章被设置为禁止添加标签").removeClass("hidden")),2===user.group&&(0|user.uid)===system.post.uid&&(user.group=3),0===user.group||3===user.group?a.addClass("manage").delegate("div.btn-delete","click",function(){var a,c;return a=$(this).closest("span.tag"),c=$.trim($.parseSafe(a.text().replace(/\(.*/,""))),a.ensure({curtain:!0,text:"是否确认删除标签["+c+"]？",callback:function(){var d;return null!=(d=b.data().port)&&d.abort(),b.data().port=$.post("/delTag.aspx",{contentId:system.post.aid,tagId:a.data().tid}).done(function(b){var d;return b.success?(a.stop().transition({opacity:0},200,function(){return a.remove()}),$.info("info::删除标签["+c+"]成功。"),d=$$("#btn-add-tag").removeClass("disabled").mouseover(function(){var a;return a="success::添加标签方便其他Acer搜索哦~~"}),$$("#curtain").click()):$.info("warning::"+b.result)}).fail(function(){return $.info("error::同服务器通信失败。请于稍后重试。")})}})}):void 0}(),setTimeout(function(){var a;return"video"===system.type?(a=$$("#block-recom-view"),$.getScript("http://search.acfun.tv/like?"+$.param({id:"ac"+system.post.aid,pageSize:5,pageNo:1,type:1,cd:1})).done(function(){var b,c,d,e,f,g,h,i,j;if(d=system.tv,200===d.status&&(f=d.data.page.list,f.length)){for(c=[63,71,73,74,75,76,81,110,113],g=$("#temp-recom-view").text(),e="",i=0,j=f.length;j>i;i++)b=f[i],h=-1!==$.inArray(b.channelIds,c)?"/v/"+b.contentId:"/a/"+b.contentId,e+=$.parseTemp(g,{aid:b.contentId.replace("ac",""),home:"/u/"+(b.userId||4)+".aspx",url:h,preview:$.parseSafe(b.titleImg)||system.path.short+"/style/image/cover-day.png",title:$.parseSafe(b.title),views:b.views,comms:b.comments,name:$.parseSafe(b.username)||"熊猫"});return a.find(".mainer").html(e)}})):void 0},1e3),function(){var a;return a=$$("#area-player").find("img:not(.img-emot-ac)").length,"article"===system.type&&(75===system.post.cid&&a>1||75!==system.post.cid&&a>8)?$.getScript(system.path.short+"/project/homura/script/manga.min.js"+$.salt(7)):void 0}(),setTimeout(system.func.saveHistory,1e4),function(){var a,b,c,d;a=system.post.cid,d=$.parseChannel.map;for(b in d)if(c=d[b],__indexOf.call(c,a)>=0){a=b;break}return $$("#guide-bar").find('a[href="/v/list'+a+'/index.htm"]').addClass("current")}(),function(){return $.get("/queryMarrow.aspx",{contentId:system.post.aid}).done(function(a){return a.success&&a.marrow?$$(".img_monkey").css({display:"block"}):void 0})}(),$(window).scroll(function(){var a,b,c;return $(window).scrollTop()>180?($$("#area-title-view").css({position:"fixed","z-index":"2","margin-left":"0",border:"1px solid #ddd"}),$$("#area-part-view").css({"margin-top":"138px"}),$$("#title_1").hide(),$$("#title_2").show()):($$("#area-title-view").css({position:"relative","z-index":"1","margin-left":"48px",border:"none"}),$$("#area-part-view").css({"margin-top":"8px"}),$$("#title_1").show(),$$("#title_2").hide()),a=$$("#area-comment"),a.length&&a.offset().top-$(window).scrollTop()-$(window).height()<-20?$$("#area-quick-comment").hide():$$("#area-quick-comment").show(),b=$("#footer").offset().top-$(window).scrollTop()-$(window).height(),c=$$("#btn-top-shortcut").css(62>b?{bottom:110-b}:{bottom:50})}),function(){var a,b,c,d,e;return c=$$("#btn-top-shortcut"),d=$$("#guide-inner"),b=$$("#area-comment"),c.length&&c.css({left:d.offset().left+d.width()+50}),b.length&&b.offset().top-$(window).height()<0&&$$("#area-quick-comment").hide(),a=$$("#bdshare_2"),e=$$(".share").mouseenter(function(){var b;return a.slideDown(),b=$(this).css({"border-left":"1px solid #ccc","border-top":"1px solid #ccc","border-right":"1px solid #ccc"}),a.css({left:b.offset().left-86,top:b.offset().top-$(window).scrollTop()+23})}).mouseleave(function(){return a.hide(),e.css({"border-left":"1px solid #f7f7f7","border-top":"1px solid #f7f7f7","border-right":"1px solid #f7f7f7"})}),a.mouseenter(function(){return a.show(),e.css({"border-left":"1px solid #ccc","border-top":"1px solid #ccc","border-right":"1px solid #ccc"})}).mouseleave(function(){return $(this).hide(),e.css({"border-left":"1px solid #f7f7f7","border-top":"1px solid #f7f7f7","border-right":"1px solid #f7f7f7"})})}(),function(){var a;return a=$$(".comment_center input"),$$(".comment_center a").click(function(){var b,c,d,e,f,g;try{ga("send","event","FastReply","comment_web","")}catch(h){e=h,console.error(e)}return g=a.val(),g.length&&(g=g.replace(/\[/g,"&#91;").replace(/\]/g,"&#93;"),g=$.parsePost(g)),d=$(this),c=$$("#btn-send-editor"),b=$.trim(g.replace(/\[.*?\]/g,"").replace(/\<.*?\>/g,"").replace(/[\s\n\r]/g,"").replace(/\&\w+?\;/g,"")).length>=5,1===d.data().status?void $.info("warning::正处于发言不应期。"):""!==g&&b?(d.data().status=1,d.text("发送中…").addClass("disabled"),c.addClass("disabled"),a.addClass("disabled"),f={name:"sendComm()",token:"mimiko",quoteId:0,text:g,cooldown:5e3,contentId:system.post.aid},system.port.postComm=$.post(system.handle.comm.send.url,f).done(function(b){return b.success||200===b.status?($.info("success::回复发送成功。"),$$("#area-comment").data().func.refreshComm(),setTimeout(function(){return $$("#quick-a").hide(),$$("#quick-b").show("slow"),setTimeout(function(){return c.removeClass("disabled"),a.val(""),d.data().status=0,d.text("快速回复").removeClass("disabled"),a.removeClass("disabled"),$$("#quick-a").show("slow"),$$("#quick-b").hide(),$$("#quick-c").hide()},3e3)},2e3)):($.info(401===b.status?"error::"+(b.info||"您已因违规操作被临时禁言。如有疑问请联系客服。"):"error::"+(b.info||"评论发送失败。请于稍后重试。")),$$("#quick-a").hide(),$$("#quick-c").show("slow"),setTimeout(function(){return $$("#quick-a").hide(),$$("#quick-b").show("slow"),setTimeout(function(){return c.removeClass("disabled"),a.val(""),d.data().status=0,d.text("快速回复").removeClass("disabled"),a.removeClass("disabled"),$$("#quick-a").show("slow"),$$("#quick-b").hide(),$$("#quick-c").hide()},3e3)},2e3))}).fail(function(){return $.info("warning::发送信息失败。请于稍后重试。"),setTimeout(function(){return $$("#quick-a").hide(),$$("#quick-c").show("slow"),setTimeout(function(){return c.removeClass("disabled"),a.val(""),d.data().status=0,d.text("快速回复").removeClass("disabled"),a.removeClass("disabled"),$$("#quick-a").show("slow"),$$("#quick-b").hide(),$$("#quick-c").hide()},3e3)},2e3)})):$.info("warning::回复长度过短。回复字数应不少于5个字符。")})}(),$("#bdshare").shareGA()})}),function(){return window.ga&&ga("send","event",$.getIds.channelId(),"viewDetailPage",$.getAcNumber())}();